--
-- PostgreSQL database dump
--

-- Dumped from database version 9.6.5
-- Dumped by pg_dump version 9.6.5

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

DROP DATABASE park;
--
-- Name: park; Type: DATABASE; Schema: -; Owner: postgres
--

CREATE DATABASE park WITH TEMPLATE = template0 ENCODING = 'UTF8' LC_COLLATE = 'ja_JP.UTF-8' LC_CTYPE = 'ja_JP.UTF-8';


ALTER DATABASE park OWNER TO postgres;

\connect park

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: plpgsql; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS plpgsql WITH SCHEMA pg_catalog;


--
-- Name: EXTENSION plpgsql; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION plpgsql IS 'PL/pgSQL procedural language';


--
-- Name: postgis; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS postgis WITH SCHEMA public;


--
-- Name: EXTENSION postgis; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION postgis IS 'PostGIS geometry, geography, and raster spatial types and functions';


SET search_path = public, pg_catalog;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- Name: categories; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE categories (
    id integer NOT NULL,
    name character varying(255) DEFAULT NULL::character varying,
    permit_flag integer DEFAULT 0 NOT NULL,
    created timestamp without time zone,
    modified timestamp without time zone
);


ALTER TABLE categories OWNER TO postgres;

--
-- Name: categories_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE categories_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE categories_id_seq OWNER TO postgres;

--
-- Name: categories_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE categories_id_seq OWNED BY categories.id;


--
-- Name: details; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE details (
    id integer NOT NULL,
    park_list_id integer NOT NULL,
    name character varying(255) DEFAULT NULL::character varying,
    value character varying(10) DEFAULT NULL::character varying,
    permit_flag integer DEFAULT 0 NOT NULL,
    created timestamp without time zone,
    modified timestamp without time zone
);


ALTER TABLE details OWNER TO postgres;

--
-- Name: details_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE details_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE details_id_seq OWNER TO postgres;

--
-- Name: details_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE details_id_seq OWNED BY details.id;


--
-- Name: park_lists; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE park_lists (
    id integer NOT NULL,
    kind character varying(255) NOT NULL,
    number integer NOT NULL,
    park_name character varying(255) NOT NULL,
    park_name_rm character varying(255) DEFAULT NULL::character varying,
    controller character varying(255) NOT NULL,
    address text,
    start_date date,
    area double precision,
    description text,
    toillet character varying(255) DEFAULT NULL::character varying,
    url text,
    latitude double precision,
    longitude double precision,
    point geometry(Point,4326) DEFAULT NULL::geometry,
    created timestamp without time zone,
    modified timestamp without time zone
);


ALTER TABLE park_lists OWNER TO postgres;

--
-- Name: park_lists_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE park_lists_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE park_lists_id_seq OWNER TO postgres;

--
-- Name: park_lists_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE park_lists_id_seq OWNED BY park_lists.id;


--
-- Name: photos; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE photos (
    id integer NOT NULL,
    park_list_id integer NOT NULL,
    photo_url character varying(255) DEFAULT NULL::character varying,
    created timestamp without time zone,
    modified timestamp without time zone
);


ALTER TABLE photos OWNER TO postgres;

--
-- Name: photos_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE photos_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE photos_id_seq OWNER TO postgres;

--
-- Name: photos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE photos_id_seq OWNED BY photos.id;


--
-- Name: posts; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE posts (
    id integer NOT NULL,
    park_list_id integer NOT NULL,
    age integer,
    rank integer,
    photo_path text,
    message text,
    created timestamp without time zone,
    modified timestamp without time zone
);


ALTER TABLE posts OWNER TO postgres;

--
-- Name: posts_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE posts_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE posts_id_seq OWNER TO postgres;

--
-- Name: posts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE posts_id_seq OWNED BY posts.id;


--
-- Name: ranks; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE ranks (
    id integer NOT NULL,
    park_list_id integer NOT NULL,
    age integer,
    rank double precision,
    created timestamp without time zone,
    modified timestamp without time zone
);


ALTER TABLE ranks OWNER TO postgres;

--
-- Name: ranks_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE ranks_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE ranks_id_seq OWNER TO postgres;

--
-- Name: ranks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE ranks_id_seq OWNED BY ranks.id;


--
-- Name: view_park_lists; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW view_park_lists AS
 SELECT p.id,
    p.kind,
    p.number,
    p.park_name,
    p.park_name_rm,
    p.controller,
    p.address,
    p.start_date,
    p.area,
    p.description,
    p.toillet,
    p.url,
    p.latitude,
    p.longitude,
    p.point,
    p.created,
    p.modified,
    a.ok,
    b.ng
   FROM ((park_lists p
     LEFT JOIN ( SELECT details.park_list_id,
            array_agg(details.name) AS ok
           FROM details
          WHERE (details.permit_flag = 1)
          GROUP BY details.park_list_id) a ON ((p.id = a.park_list_id)))
     LEFT JOIN ( SELECT details.park_list_id,
            array_agg(details.name) AS ng
           FROM details
          WHERE (details.permit_flag = 2)
          GROUP BY details.park_list_id) b ON ((p.id = b.park_list_id)))
  ORDER BY p.id;


ALTER TABLE view_park_lists OWNER TO postgres;

--
-- Name: categories id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY categories ALTER COLUMN id SET DEFAULT nextval('categories_id_seq'::regclass);


--
-- Name: details id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY details ALTER COLUMN id SET DEFAULT nextval('details_id_seq'::regclass);


--
-- Name: park_lists id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY park_lists ALTER COLUMN id SET DEFAULT nextval('park_lists_id_seq'::regclass);


--
-- Name: photos id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY photos ALTER COLUMN id SET DEFAULT nextval('photos_id_seq'::regclass);


--
-- Name: posts id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY posts ALTER COLUMN id SET DEFAULT nextval('posts_id_seq'::regclass);


--
-- Name: ranks id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY ranks ALTER COLUMN id SET DEFAULT nextval('ranks_id_seq'::regclass);


--
-- Name: categories categories_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY categories
    ADD CONSTRAINT categories_pkey PRIMARY KEY (id);


--
-- Name: details details_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY details
    ADD CONSTRAINT details_pkey PRIMARY KEY (id);


--
-- Name: park_lists park_lists_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY park_lists
    ADD CONSTRAINT park_lists_pkey PRIMARY KEY (id);


--
-- Name: photos photos_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY photos
    ADD CONSTRAINT photos_pkey PRIMARY KEY (id);


--
-- Name: posts posts_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY posts
    ADD CONSTRAINT posts_pkey PRIMARY KEY (id);


--
-- Name: ranks ranks_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY ranks
    ADD CONSTRAINT ranks_pkey PRIMARY KEY (id);


--
-- Name: public; Type: ACL; Schema: -; Owner: postgres
--

GRANT ALL ON SCHEMA public TO PUBLIC;


--
-- PostgreSQL database dump complete
--

